---
title: Rubicon | March√© Rubicon
pageTitle: March√© Rubicon
description: Aper√ßu et documentation du contrat de carnet de commandes de Rubicon
---

La logique d'√©change de base de Rubicon r√©side dans le [RubiconMarket](https://github.com/RubiconDeFi/rubicon_protocol/blob/master/contracts/RubiconMarket.sol) contrat intelligent - le carnet de commandes central de Rubicon. Il est utile de consid√©rer ce contrat intelligent comme une couche interm√©diaire qui facilite l'√©change d'actifs num√©riques entre pairs via un carnet de commandes.

# üìä March√© Rubicon

## Aper√ßu

Le contrat intelligent Rubicon Market impl√©mente des carnets de commandes en cha√Æne et un moteur de correspondance pour le trading peer-to-peer de [ERC-20 tokens](https://ethereum.org/en/developers/docs/standards/tokens/erc-20/).

Un carnet d'ordres est une liste d'ordres d'achat et de vente pour un actif, tri√©s par prix. Ce contrat impl√©mente chaque carnet de commandes ERC20/ERC20 sous la forme de deux listes tri√©es √† double lien, une pour le c√¥t√© achat et une pour le c√¥t√© vente du march√© donn√©.

Le contrat utilise un mod√®le de s√©questre pour la liquidit√©¬†; lorsqu'un ordre √† cours limit√© est plac√© sur le livre, ces jetons sont envoy√©s au contrat. Si/quand une commande est ex√©cut√©e, le contrat correspond directement aux commer√ßants et les jetons sont envoy√©s √† chaque partie. Une commande peut √™tre annul√©e et le contrat renverra les jetons √† l'exp√©diteur.

Rubicon Market est une ≈ìuvre d√©riv√©e de l'open-source de MakerDAO [OasisDEX](https://oasisdex.com/) et h√©rite de la licence AGPL3.

## Fonctions de n√©gociation

### offre()

```
    function offer(
        uint256 pay_amt,
        ERC20 pay_gem,
        uint256 buy_amt,
        ERC20 buy_gem,
        uint256 pos,
    ) public returns (uint256)
```

| Parameter Name         | Type        | Description                                                                                                                       |
| ---------------------- | ----------- | --------------------------------------------------------------------------------------------------------------------------------- |
| pay\_amt               | uint256     | Quantity of ERC-20 tokens the maker is selling                                                                                    |
| pay\_gem               | address     | ERC-20 token the maker is selling                                                                                                 |
| uint buy\_amt          | uint256     | Quantity of ERC-20 tokens the maker is buying                                                                                     |
| ERC20 buy\_gem         | address     | ERC-20 token the maker is buying                                                                                                  |
| uint pos               | uint256     | Position in the sorted list to place the order. Set this to 0 unless you know the exact position (closest ID) to insert the order |
| \[Optional] matching   | bool        | Optional boolean to determine whether the offer should be automatically matched (placed in the sorted list)                       |

The primary function for placing limit orders on Rubicon. The **pay_amt** quantity of the **pay_gem** token will be sent to the order book contract, sitting in escrow until it is filled or canceled. Always set pos to **0** unless you know the exact position in the sorted lost to insert the order.

### cancel()

```
    function cancel(uint id)
        public
        can_cancel(id)
        returns (bool success)
```

| Parameter Name         | Type        | Description                                    |
| ---------------------- | ----------- | ---------------------------------------------- |
| id                     | uint256     | The id of the order the user wants to cancel   |

Cette fonction est utilis√©e pour remplir ou "choisir" une commande sp√©cifique dans le livre. L'appelant paiera les frais de prise en charge. Alternativement, vous pouvez utiliser la fonction de routage **take()** pour obtenir le m√™me r√©sultat et remplir une offre sp√©cifique.

### buy()

```
    function buy(uint id, uint amount) public can_buy(id) 
        returns (bool)
```

| Parameter Name         | Type        | Description                                    |
| ---------------------- | ----------- | ---------------------------------------------- |
| id                     | uint256     | The id of the target order                     |
| amount                 | uint256     | Quantity of the target order to buy            |

### buyAllAmount()

```
     function buyAllAmount(
        ERC20 buy_gem,
        uint256 buy_amt,
        ERC20 pay_gem,
        uint256 max_fill_amount
    ) external returns (uint256 fill_amt)
```

| Parameter Name         | Type        | Description                                    |
| ---------------------- | ----------- | ---------------------------------------------- |
| buy\_gem               | address     | ERC-20 token the taker is buying               |
| buy\_amt               | uint256     | Quantity of tokens the taker is buying         |
| pay\_gem               | address     | ERC-20 token the taker is selling              |
| max\_fill\_amount      | uint256     | Maximum amount of pay tokens sold              |

Tente d'√©changer la quantit√© **sell_amt** de jetons **sell_gem** contre au moins la quantit√© **min_fill_amount** de jetons **pay_gem**. La transaction sera annul√©e si le commer√ßant re√ßoit moins que le montant minimum sp√©cifi√©. Il s'agit d'un ordre de vente "Fill-or-Kill".

## Afficher les fonctions

### getBestOffer()

```
function getBestOffer(ERC20 pay_gem, ERC20 buy_gem)
    public
    view
    returns (uint256)
```

Renvoie l'ID de l'offre en haut du carnet de commandes.

Ex. Appeler cette fonction avec WETH comme **pay_gem** et USDC comme **buy_gem** renverra la meilleure demande sur WETH/USDC. Changer les jetons renverra la meilleure ench√®re.

### getWorseOffer()

```
function getWorseOffer(uint256 id)
    public
    view
    returns (uint256)
```

Renvoie l'offre la moins bonne suivante dans la liste tri√©e. La pire offre est la plus √©lev√©e si l'ordre cible est une demande, et la plus basse s'il s'agit d'une offre. Dans les deux cas, il en renverra un plus r√©cent s'ils sont √©gaux.

### getBuyAmount()

```
    function getBuyAmount(
        ERC20 buy_gem,
        ERC20 pay_gem,
        uint256 pay_amt
    ) external view returns (uint256 fill_amt)
```

Renvoie le nombre de jetons **buy_gem** re√ßus si un montant sp√©cifi√© de jetons **pay_gem** est d√©pens√©. Utilis√© pour v√©rifier l'√©tat actuel du carnet de commandes.

### getPayAmount()

```
function getPayAmount(
        ERC20 pay_gem,
        ERC20 buy_gem,
        uint256 buy_amt
    ) external view returns (uint256 fill_amt)
```

Renvoie le nombre de jetons **pay_gem** n√©cessaires pour acheter un nombre sp√©cifi√© de jetons **buy_gem**. Utilis√© pour v√©rifier l'√©tat actuel du carnet de commandes.

### getOfferCount()

```
function getOfferCount(ERC20 sell_gem, ERC20 buy_gem)
        public
        view
        returns (uint256)
```

Renvoie le nombre d'offres dans le carnet de commandes pour une paire sp√©cifi√©e.

### getFeeBPS()

```
function getFeeBPS()
    public
    view
    returns (uint256)
```

Renvoie les frais du preneur de protocole, en points de base.
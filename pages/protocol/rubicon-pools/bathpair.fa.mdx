---
title: روبیکن | جفت حمام
pageTitle: جفت حمام
description: ساخت بازار خاص جفت و اجرای استراتژی
---

## جفت حمام

[BathPair contract](https://github.com/RubiconDeFi/rubicon_protocol/blob/master/contracts/rubiconPools/BathPair.sol) با اجازه دادن به استراتژیست ها، نقدینگی کاربر و ملاحظات کلیدی امنیتی توانایی جمع شدن برای یک جفت معاملاتی معین، قلب Rubicon Pools را نشان می دهد. این قرارداد به استراتژیست ها اجازه می دهد تا نقدینگی کاربر را به منظور بازاریابی در بازار روبیکون مستقر کنند. علاوه بر این، این قرارداد تضمین می‌کند که وجوه کاربر در برابر عوامل بالقوه مخرب در امان است و در سیستم حلقه بسته که Rubicon Pools است، باقی می‌ماند.

### توابع کلیدی

- "initializePair" - این تابع زمانی فراخوانی می شود که Bath House این قرارداد را مقداردهی اولیه کند. این تابع اگر توکن‌های Bath جدید برای نمونه Bath Pair وجود نداشته باشد ایجاد می‌کند و اگر از قبل وجود داشته باشد، جفت را به یک نماد Bath نقل قول موجود می‌دهد.
- "executeStrategy" - این تابع اصلی BathPair.sol است. در نسخه صفر Rubicon Pools، به یک استراتژیست اجازه می دهد تا با نقدینگی bathToken که توسط این جفت مدیریت می شود، معامله جفتی (پرسش و پیشنهاد) انجام دهد. \_این تابع نقطه ورود استراتژیست ها به بازارسازی و اهرم نقدینگی کاربر است.

  - پارامترهای ارائه شده توسط استراتژیست هنگام فراخوانی این تابع عبارتند از:

    ```
        address targetStrategy,
        uint256 askNumerator, // *Asset Amt* / Quote Amt
        uint256 askDenominator, // Asset Amt / *Quote Amt*
        uint256 bidNumerator, // *Quote Amt* / Asset Amt
        uint256 bidDenominator // Quote Amt / *Asset Amt*
    ```

- "getMaxOrderSize" - این تابع بزرگترین اندازه سفارش را برای یک پیشنهاد یا درخواستی که یک استراتژیست می تواند با وجوه کاربر ارسال کند، برمی گرداند. علاوه بر این، این تابع اندازه نظم نسبی و پویا [inventory management](/docs/protocol/rubicon-pools/rubicon-pools#constraints-and-risk-parameters) را تضمین می کند اجرا می شوند.
- "strategistBootyClaim" - این تابع توسط استراتژیست ها فراخوانی می شود تا به طور خودکار بازدهی به دست آمده را به آنها برگرداند که ممکن است با بازارسازی موفق به دست آمده باشد. محاسبه کلیدی برای ادعای بازدهی این است (تعداد سفارشات تکمیل شده در نتیجه این استراتژیست) / (مقدار کل سفارشات تکمیل شده برای دارایی داده شده) \* (مقدار اساسی بازده).

### پارامترهای کلیدی امنیتی و جریان اجرا

تعدادی از پارامترهای امنیتی وجود دارد که برای اطمینان از اینکه بازیگران مخرب یا بازارسازان ضعیف نمی توانند سرمایه کاربر را به طور غیر موثر در بازار روبیکون مستقر کنند وجود دارد. همه این توابع و پارامترها در فراخوانی تابع واحدی که توسط استراتژیست انجام می شود نقش دارند: «executeStrategy». لطفاً آنها را به ترتیبی که در طول اجرای فراخوانی تابع رخ می دهند در زیر مشاهده کنید.

- «onlyApprovedStrategy» - استراتژی هدف این فراخوانی تابع باید توسط خانه حمام تأیید شود.
- «EnforceReserveRatio» - این اصلاح‌کننده تضمین می‌کند که «ReserveRatio» برای هر یک از استخرهای نقدینگی زیربنایی (دارایی و مظنه bathTokens) _قبل و بعد از اجرای تابع_ مشاهده می‌شود.
- "getMaxOrderSize" - این تابع در اینجا استفاده می شود تا اطمینان حاصل شود که شمارشگر (آنچه از استخرهای نقدینگی استفاده می شود) پیشنهاد و درخواست به محدودیت های مدیریت موجودی پویا جفتی پایبند است.
- "EnforceSpread" - این تابع تضمین می کند که (الف) در سفارشات ارسال شده برای یک معامله جفتی اسپرد وجود دارد و (ب) اینکه معامله جفت دارای قیمت درخواست/پیشنهاد است که در نیمه صحیح دفترچه سفارش است (پرسش). /bid یک درخواست معتبر است. `/` midpoint price of the order book). A price oracle will be implemented in future versions to further ensure that midpoint of the order book is respected as a valid point of reference.
- `IPairsTrade(targetStrategy).execute` - the strategy is then called and a pairs trade is placed. See PairsTrade.sol.
- `cancelPartialFills` - this crucial function parses through the outstanding orders for this pair in the order book and (a) cancels any orders whose counterparts (the bid to an ask) of the pairs trade have been filled. This represents a yield event in which a pair's trade was partially filled. (b) Any orders that have exceeded the `timeDelay` for this pair are canceled to ensure no liquidity is locked in old orders.
- `rebalancePair` - this simple function sends any filled orders that send ERC-20 assets to a Bath Token's sister pool (Asset `< - >` نقل قول) به استخر نقدینگی صحیح باز می گردد تا بازدهی قابل تحقق باشد.

---
title: Rubicon | Bath Token API
description: Обзор ключевых сущностей подграфа токена Bath, обработчиков событий контракта и примеров запросов для различных вариантов использования.
---

# API BathToken

## **Ключевые сущности BathToken**

Подграф BathToken содержит набор сущностей, которые собирают и хранят данные, связанные с деятельностью поставщика ликвидности и использованием пула для создания рынка в книгах заказов протокола. Ниже приведены ключевые объекты, которые, по нашему мнению, пользователи сочтут наиболее соответствующими их потребностям в данных.

### _**LiquidityProvider Entity (ID: Адрес кошелька)**_

```graphql
type LiquidityProvider @entity { 
    " <user adddress> "
    id: ID!
    " derived fields"
    positions: [PoolPosition!]! @derivedFrom(field: "liquidityProvider")
    deposits: [Deposit!]! @derivedFrom(field: "liquidityProvider")
    withdraws: [Withdraw!]! @derivedFrom(field: "liquidityProvider")
}
```

Сущность LiquidityProvider действует как единая точка отсчета для сбора всей активности с пулами ликвидности Rubicon с адреса кошелька. Из сущности LiquidityProvider вы можете получить доступ к сущностям PoolPosition, Deposit и Withdraw.

### _PoolPosition Entity (ID: \<user address>#\<pool underlying asset address>)_

```graphql
type PoolPosition @entity {
    " <user address>#<pool underlying asset address> "
    id: ID!
    " the liquidity provider is "
    liquidityProvider: LiquidityProvider!
    " the pool is "
    pool: Pool!
    " current bathToken balance "
    bathTokenAmount: BigInt!
    " total value of pool deposits "
    totalDeposited: BigInt!
    " total value of pool withdraws "
    totalWithdrawn: BigInt!
}
```

Сущность PoolPosition представляет активное состояние активов пользователя в пуле ликвидности Rubicon. Чтобы получить доступ к текущему состоянию пула, включая общий объем, непогашенную сумму и цену BathToken, можно получить доступ к сущности пула. Все значения выражены в целочисленном значении базового токена ERC20, который они представляют.

### Объект пула (ID: \<pool underlying asset address>)

```graphql
type Pool @entity { 
    " <pool underlying asset address> " 
    id: ID! 
    " derived from "
    bathHouse: BathHouse!
    " pool name "
    name: String!
    " pool asset address "
    underlyingToken: String!
    " creation time "
    createdAtTimestamp: BigInt!
    " block pool was created at "
    createdAtBlockNumber: BigInt!
    " address of bath token creator "
    bathTokenCreator: String!
    " pool underlying balance (amount in pool and on books) "
    underlyingBalance: BigInt!
    " amount of pool assets outstanding on the orderbook "
    outstandingAmount: BigInt!
    " shares outstanding (BathTokens) "
    tokenSupply: BigInt!
    " total value of pool deposits "
    totalDeposited: BigInt!
    " total value of pool withdraws "
    totalWithdrawn: BigInt!
    " BathToken Price: total suppply / underlying balance "
    price: BigDecimal!
    " total earned from market making activity "
    totalEarned: BigInt!
    " daily snapshots of pool data "
    poolDayData: [PoolDayData!]! @derivedFrom(field: "pool")
    " hourly snapshots of pool data "
    poolHourData: [PoolHourData!]! @derivedFrom(field: "pool")
    " derived fields "
    deposits: [Deposit!]! @derivedFrom(field: "pool")
    withdraws: [Withdraw!]! @derivedFrom(field: "pool")
    PoolBuffers: [PoolBuffer!]! @derivedFrom(field: "pool")
}
```
```

Сущность пула содержит всю необходимую информацию о текущем и историческом состоянии или пуле ликвидности. Сущность пула сопоставляется с несколькими другими сущностями, с которыми она связана. Наиболее релевантными сущностями, которые он отображает, являются сущности PoolDayData, PoolHourData и PoolBuffer. Переменная totalEarned объекта Pool рассчитывается следующим образом.

$$
totalEarned = базовый баланс - (totalDeposited - totalWithdrawn)
$$

Каждый объект пула также имеет два связанных объекта, которые отслеживают статистику пула за заданный период времени: PoolDayData и PoolHourData. Идентификаторы для этой пары следующие:

* PoolDayData(ID: \<pool underlying asset address>#\<timestamp rounded to current day by dividing by 86400>)
* PoolHourData(ID: \<pool underlying asset address>#_\<timestamp rounded to current hour by dividing by 3600>_)

Все значения выражены в целочисленном значении базового токена ERC-20, который они представляют.

### Объект PoolBuffer (ID: \<pool underlying asset address>#\<buffer asset address>)

```graphql
type PoolBuffer @entity {
    " <pool underlying asset address>#<buffer asset address> "
    id: ID!
    " the pool is"
    pool: Pool!
    " token address of asset in buffer "
    token: String!
    " name of asset in buffer "
    name: String!
    " amount of token in buffer "
    bufferAmount: BigInt!
}
```

Сущность PoolBuffer соответствует сумме актива родственных пар, который находится в пуле ликвидности и ожидает перебалансировки. Наглядное изображение ниже поможет объяснить этот процесс и то, чему соответствует сумма буфера пула.

TODO: \*вставить визуализацию сверху\*

Каждый объект PoolBuffer также имеет два связанных объекта, которые отслеживают статистику PoolBuffer за заданный период времени: PoolDayData и PoolHourData. Идентификаторы для этой пары следующие:

* PoolBufferDay(ID: \<pool underlying asset address>#\<buffer asset address>#\<timestamp rounded to current day by dividing by 86400>)
* PoolBufferHour(ID: \<pool underlying asset address>#\<buffer asset address>#_\<timestamp rounded to current hour by dividing by 3600>_)

Все значения выражены в целочисленном значении базового токена ERC-20, который они представляют.

### Депозитный объект (ID: \<transaction hash>#\<user address>)

```graphql
type Deposit @entity {
    " <transaction hash>#<user address> "
    id: ID!
    " time of txn "
    timestamp: BigInt!
    " transaction details "
    transaction: Transaction!
    " pool to deposit in "
    pool: Pool!
    " amount deposited into pool "
    depositAmount: BigInt!
    " Bath Tokens received "
    bathTokenAmount: BigInt! 
    " BathToken Price: total suppply / underlying balance "
    price: BigDecimal!
    " liquidity provider "
    liquidityProvider: LiquidityProvider!
    " map to PoolDayData entity "
    poolDayData: PoolDayData!
    " map to PoolHourData entity "
    poolHourData: PoolHourData!
} 
```

Сущность «Депозит» соответствует любому депозиту, размещенному поставщиком ликвидности в пулах Rubicon. Объект Депозит содержит все соответствующие данные о депозите, такие как сумма депозита и полученные акции, а также сопоставление с другими соответствующими объектами. Все значения выражены в целочисленном значении базового токена ERC20, который они представляют.

### Вывести объект (ID: \<transaction hash>#\<user address>)

```graphql
type Withdraw @entity {
    " <transaction hash>#<user address> "
    id: ID!
    " time of txn "
    timestamp: BigInt!
    " transaction details "
    transaction: Transaction!
    " pool to withdraw from "
    pool: Pool!
    " amount withdrawn from the pool "
    withdrawAmount: BigInt!
    " Bath Tokens burned "
    bathTokenBurned: BigInt! 
    " BathToken Price: total suppply / underlying balance "
    price: BigDecimal!
    " liquidity provider "
    liquidityProvider: LiquidityProvider!
    " map to PoolDayData entity "
    poolDayData: PoolDayData!
    " map to PoolHourData entity "
    poolHourData: PoolHourData!
} 
```

Сущность Withdraw соответствует любому депозиту, размещенному поставщиком ликвидности в пулах Rubicon. Сущность Withdraw содержит все соответствующие данные о депозите, такие как сумма снятия и полученные доли, а также сопоставление с другими соответствующими сущностями. Все значения выражены в целочисленном значении базового токена ERC20, который они представляют.

## _**Примеры запросов**_

Следующие запросы представляют собой некоторые распространенные сценарии использования для потенциальных потребностей в данных, связанных с подграфом BathToken.

| Use Case                                               | Subgraph Studio Example                                                                                                                  |
| ------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Access a User's liquidity pool positions               | [Pool Positions](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=liquidityProviders)                      |
| Check on the current statistics of the liquidity pools | [Current Pool Statistics](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=Pools)                          |
| Load in the historical pools data                      | [Historical Pools Data](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=Pools%20Historical%20Performance) |
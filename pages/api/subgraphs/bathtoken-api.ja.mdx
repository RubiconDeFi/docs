---
title: ルビコン/バストークンAPI
description: Bathトークンサブグラフのキーエンティティ、コントラクトイベントハンドラーの概要, そして、さまざまなユースケースのクエリの例。
---

# バストークン API

## **BathToken キー エンティティ**

BathToken サブグラフには、プロトコルのオーダー ブックでのマーケット メイキングのための流動性プロバイダーのアクティビティとプールの利用に関連するデータを収集および保存するエンティティのコレクションが含まれています。以下は、ユーザーがデータのニーズに最も関連すると思われる主要なエンティティです。

### _**LiquidityProvider エンティティ (ID: ウォレット アドレス)**_

```graphql
タイプLiquidityProvider @エンティティ{
    " <user adddress> "
    やった！
    「派生フィールド」
    位置: [PoolPosition!]! @派生元(フィールド: "流動性プロバイダー")
    デポジット: [デポジット!]! @派生元(フィールド: "流動性プロバイダー")
    撤回: [撤回!]! @派生元(フィールド: "流動性プロバイダー")
}
```

LiquidityProvider エンティティは、ウォレットのアドレスから Rubicon 流動性プールのすべてのアクティビティを収集するための単一の参照ポイントとして機能します。 LiquidityProvider エンティティ内から、PoolPosition、Deposit、および Withdraw エンティティにアクセスできます。

### _PoolPosition エンティティ (ID: \<user address>#\<pool underlying asset address>)_

```graphql
タイプ PoolPosition @entity {
    " <user address>#<pool underlying asset address> "
    やった！
    "流動性プロバイダーは"
    流動性プロバイダー: 流動性プロバイダー!
    「プールは」
    プール：プール！
    「現在のbathToken残高」
    bathTokenAmount: BigInt!
    「プール預金の総額」
    totalDeposited: BigInt!
    "プールの合計金額が引き出されます"
    総撤回: BigInt!
}
```

PoolPosition エンティティは、Rubicon 流動性プールでのユーザーの持ち株のアクティブな状態を表します。プールの現在の状態 (合計量、未払い額、bathToken 価格など) にアクセスするには、Pool エンティティにアクセスできます。すべての値は、それらが表す基礎となる ERC20 トークンの整数値で表されます。

### プール エンティティ (ID: \<pool underlying asset address>)

```graphql
タイプ プール @エンティティ {
    " <pool underlying asset address> "
    やった！
    " に由来する "
    バスハウス：バスハウス！
    「プール名」
    名前：ひも！
    「プール資産アドレス」
    基になるトークン: 文字列!
    「作成時間」
    createdAtTimestamp: BigInt!
    " ブロックプールは " に作成されました
    createdAtBlockNumber: BigInt!
    「バストークン作成者のアドレス」
    bathTokenCreator: 文字列!
    「プール原資産残高（プールおよび帳簿上の金額）」
    基礎となるバランス: BigInt!
    " オーダーブックにあるプール資産残高 "
    未払い額: BigInt!
    " 発行済株式数 (BathTokens) "
    tokenSupply: BigInt!
    「プール預金の総額」
    totalDeposited: BigInt!
    "プールの合計金額が引き出されます"
    総撤回: BigInt!
    " BathToken 価格: 総供給量 / 原資産残高 "
    価格: BigDecimal!
    「マーケットメイク活動から得た合計」
    totalEarned: BigInt!
    " プール データの毎日のスナップショット "
    poolDayData: [PoolDayData!]! @派生元(フィールド: "プール")
    " プール データの 1 時間ごとのスナップショット "
    poolHourData: [PoolHourData!]! @派生元(フィールド: "プール")
    「派生フィールド」
    デポジット: [デポジット!]! @派生元(フィールド: "プール")
    撤回: [撤回!]! @派生元(フィールド: "プール")
    PoolBuffers: [PoolBuffer!]! @派生元(フィールド: "プール")
}
```

プール エンティティには、現在および過去の状態、または流動性プールに関するすべての関連情報が含まれています。プール エンティティは、関連付けられている他の複数のエンティティにマップされます。マップする最も関連性の高いエンティティは、PoolDayData、PoolHourData、および PoolBuffer エンティティです。 Pool エンティティの totalEarned 変数は次のように計算されます。

$$
totalEarned = 基礎となる残高 - (合計入金 - 合計引き出し)
$$

すべてのプール エンティティには、プールの統計を一定期間追跡する 2 つの関連付けられたエンティティ (PoolDayData と PoolHourData) もあります。これらのペアの ID は次のとおりです。

* PoolDayData(ID: \<pool underlying asset address>#\<timestamp rounded to current day by dividing by 86400>)
* PoolHourData(ID: \<pool underlying asset address>#_\<timestamp rounded to current hour by dividing by 3600>_)

すべての値は、それらが表す基礎となる ERC-20 トークンの整数値で表されます。

### PoolBuffer エンティティ (ID: \<pool underlying asset address>#\<buffer asset address>)

```graphql
タイプ PoolBuffer @エンティティ {
    " <pool underlying asset address>#<buffer asset address> "
    やった！
    「プールは」
    プール：プール！
    " バッファ内のアセットのトークン アドレス "
    トークン: 文字列!
    " バッファ内のアセットの名前 "
    名前：ひも！
    " バッファ内のトークンの量 "
    bufferAmount: BigInt!
}
```

PoolBuffer エンティティは、リバランスされるのを待っている流動性プールにある姉妹ペア資産の量に対応します。以下の図は、このプロセスとプール バッファーの量が何に対応するかを説明するのに役立ちます。

TODO: \*上から視覚化を挿入\*

すべての PoolBuffer エンティティには、設定された期間にわたって PoolBuffer 統計を追跡する 2 つの関連付けられたエンティティ (PoolDayData と PoolHourData) もあります。これらのペアの ID は次のとおりです。

* PoolBufferDay(ID: \<pool underlying asset address>#\<buffer asset address>#\<timestamp rounded to current day by dividing by 86400>)
* PoolBufferHour(ID: \<pool underlying asset address>#\<buffer asset address>#_\<timestamp rounded to current hour by dividing by 3600>_)

すべての値は、それらが表す基礎となる ERC-20 トークンの整数値で表されます。

### 入金エンティティ (ID: \<transaction hash>#\<user address>)

```graphql
タイプ預金 @entity {
    " <transaction hash>#<user address> "
    やった！
    「送信時刻」
    タイムスタンプ: BigInt!
    「お取引明細」
    トランザクション: トランザクション!
    " 入金するプール "
    プール：プール！
    「プールに入金された金額」
    デポジット金額: BigInt!
    「バストークンを受け取りました」
    bathTokenAmount: BigInt!
    " BathToken 価格: 総供給量 / 原資産残高 "
    価格: BigDecimal!
    「流動性プロバイダー」
    流動性プロバイダー: 流動性プロバイダー!
    " PoolDayData エンティティにマップ "
    プールデイデータ: プールデイデータ!
    " PoolHourData エンティティにマップ "
    プール時間データ: プール時間データ!
}
```

Deposit エンティティは、流動性プロバイダーによって Rubicon プールに置かれた任意の預金に対応します。 Deposit エンティティには、他の関連エンティティへのマッピングとともに、預金額や受け取った株式など、預金に関するすべての関連データが含まれています。すべての値は、それらが表す基礎となる ERC20 トークンの整数値で表されます。

### エンティティを撤回 (ID: \<transaction hash>#\<user address>)

```graphql
タイプ撤退 @entity {
    " <transaction hash>#<user address> "
    やった！
    「送信時刻」
    タイムスタンプ: BigInt!
    「お取引明細」
    トランザクション: トランザクション!
    「脱退するプール」
    プール：プール！
    「プールからの引き出し額」
    引き出し量: BigInt!
    「バストークンを燃やした」
    bathTokenBurned: BigInt!
    " BathToken 価格: 総供給量 / 原資産残高 "
    価格: BigDecimal!
    「流動性プロバイダー」
    流動性プロバイダー: 流動性プロバイダー!
    " PoolDayData エンティティにマップ "
    プールデイデータ: プールデイデータ!
    " PoolHourData エンティティにマップ "
    プール時間データ: プール時間データ!
}
```

Withdraw エンティティは、流動性プロバイダーによってルビコン プールに置かれた預金に対応します。 Withdrawエンティティには、他の関連エンティティへのマッピングとともに、引き出し金額や受け取ったシェアなど、預金に関するすべての関連データが含まれています。すべての値は、それらが表す基礎となる ERC20 トークンの整数値で表されます。

## _**クエリの例**

次のクエリは、BathToken サブグラフに関連する潜在的なデータ ニーズに対する一般的なユース ケース シナリオです。

| Use Case                                               | Subgraph Studio Example                                                                                                                  |
| ------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Access a User's liquidity pool positions               | [Pool Positions](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=liquidityProviders)                      |
| Check on the current statistics of the liquidity pools | [Current Pool Statistics](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=Pools)                          |
| Load in the historical pools data                      | [Historical Pools Data](https://thegraph.com/hosted-service/subgraph/denverbaumgartner/bathtoken?query=Pools%20Historical%20Performance) |